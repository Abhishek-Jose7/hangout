// Prisma schema for hangout app using PostgreSQL (Supabase)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Group {
  id       String   @id @default(cuid())
  code     String   @unique
  members  Member[]
  votes    ItineraryVotes[]

  @@index([code])
}

model Member {
  id        String  @id @default(cuid())
  name      String
  location  String
  budget    Float
  moodTags  String   // Comma-separated tags as stored by API
  firebaseUid String? // Firebase user ID for authentication
  email     String?  // User's email from Firebase

  groupId   String
  group     Group   @relation(fields: [groupId], references: [id], onDelete: Cascade)

  votes     ItineraryVotes[]

  @@index([groupId])
  @@index([firebaseUid])
  @@unique([firebaseUid, groupId]) // One user can only be in a group once
}

model ItineraryVotes {
  id           String @id @default(cuid())
  groupId      String
  memberId     String
  itineraryIdx Int

  group        Group  @relation(fields: [groupId], references: [id], onDelete: Cascade)
  member       Member @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([groupId, memberId])
  @@index([groupId])
  @@index([memberId])
}
